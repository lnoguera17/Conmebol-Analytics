---
title: "Modein Conmebol"
author: "Luis Noguera"
date: "5/31/2020"
output: html_document
---

```{r setup, include=FALSE}
library(readxl)
library(tidyverse)
library(plotly)

theme_set(theme_minimal())

conmebol <- read_csv("conmebol.csv") 

```


# Data Cleaning

```{r}

conmebol <- conmebol %>%
  select(-X1) %>%
  mutate(rating = as.numeric(rating), 
         value = str_remove(value, "â‚¬"),
         value = str_remove(value, 'M'),
         value = as.double(value),
         value = replace_na(value, 0))

```


# Data Exploration

```{r}


conmebol %>%
  mutate(best_position = fct_reorder(best_position, rating, .fun = median)) %>%
  ggplot(aes(best_position, rating)) +
  geom_boxplot() +
  coord_flip()



conmebol %>%
  filter(best_position == 'ST') %>%
  mutate(foot = fct_reorder(foot, rating)) %>%
  ggplot(aes(foot, rating, fill = foot)) +
  geom_boxplot() +
  facet_wrap(~best_position, scales = 'free') 



```

```{r}
# Visualization 

## Average per Country
Overall_avg_LATAM <- ggplot(stats, aes(reorder(nationality, -overall_avg), overall_avg))  +
  geom_text(aes(label = round(overall_avg,2)), hjust = -0.05) +
  geom_bar(stat = 'identity')  +
  labs(y= 'Overall Average',
       x= "Country") +
  theme_light() +
  coord_flip()
Overall_avg_LATAM


# World Map

## Loading Map data
worldmap <- map_data('world')

merged_data2 <- conmebol %>% 
  inner_join(worldmap, by = c('nationality' = 'region')) %>%
  group_by(nationality) %>%
  summarise(overall_avg = mean(overall)) %>%
  ungroup() %>%
  inner_join(worldmap, by = c('nationality' = 'region')) %>%
  select(overall_avg, lat, long, nationality, group)

overall_map <- ggplot(data = merged_data2, aes(x = long, y = lat, group = group)) +
  geom_polygon(aes(fill = overall_avg)) +
  labs(fill='Total Player Counts')
overall_map

## Interactive Plot
ggplotly(overall_map)




```



```{r}


conmebol %>% 
  filter(value != 0.0) %>%
  mutate(nationality = fct_lump_min(nationality, 60)) %>%
  ggplot(aes(value, overall)) +
  geom_point() +
  geom_smooth(method = 'gam') +
  facet_wrap(~nationality, scales = 'free')


conmebol_num <- conmebol %>% 
  select(-id, -height, -name, -best_position, -foot, -nationality)


library(GGally)

# Highly correlated dataset - Will try regularization method Lasso or Ridge and a Random Forest model. 
ggcorr(conmebol_num)


```


```{r}
library(tidymodels)

# Initial Split


```

